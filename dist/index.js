"use strict";var D=Object.create;var d=Object.defineProperty;var I=Object.getOwnPropertyDescriptor;var G=Object.getOwnPropertyNames,k=Object.getOwnPropertySymbols,U=Object.getPrototypeOf,M=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var E=(e,o,t)=>o in e?d(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t,y=(e,o)=>{for(var t in o||(o={}))M.call(o,t)&&E(e,t,o[t]);if(k)for(var t of k(o))q.call(o,t)&&E(e,t,o[t]);return e};var J=(e,o)=>{for(var t in o)d(e,t,{get:o[t],enumerable:!0})},L=(e,o,t,r)=>{if(o&&typeof o=="object"||typeof o=="function")for(let n of G(o))!M.call(e,n)&&n!==t&&d(e,n,{get:()=>o[n],enumerable:!(r=I(o,n))||r.enumerable});return e};var x=(e,o,t)=>(t=e!=null?D(U(e)):{},L(o||!e||!e.__esModule?d(t,"default",{value:e,enumerable:!0}):t,e)),K=e=>L(d({},"__esModule",{value:!0}),e);var Z={};J(Z,{default:()=>V});module.exports=K(Z);var b=x(require("vite"));var w=x(require("os"));function Q(e){return Object.prototype.toString.call(e)==="[object RegExp]"}function X(e){return Object.prototype.toString.call(e)==="[object String]"}function f(e){return Object.prototype.toString.call(e)==="[object Object]"}function S(e){return Array.isArray(e)}function v(e){return Object.prototype.toString.call(e)==="[object Function]"}function O(e){return Object.prototype.toString.call(e)==="[object Boolean]"}function T(e,o){for(let t of o)if(Q(t)){if(t.test(e))return!0}else if(X(t)&&e.includes(t))return!0;return!1}var A=require("worker_threads"),P=x(require("path")),R=x(require("javascript-obfuscator")),g=class{constructor(o){this.show=o;this._log=o?console.log.bind(console):this.noop}noop(o){}forceLog(...o){console.log(...o)}info(o){this._log(o)}};function B(e){let o=Math.floor(e/36e5),t=Math.floor(e%36e5/6e4),r=Math.floor(e%6e4/1e3);return[o?`${o}h `:"",t?`${t}m `:"",r||!o&&!t?`${r}s`:""].filter(Boolean).join("")}function _(e){let{threadPool:o}=e;return O(o)?o:f(o)?o.enable:!1}function F(e){let{threadPool:o}=e,t=w.default.cpus().length;return O(o)?t:f(o)&&o.enable?o.size>t||!o.size?t:o.size:t}function z(e,o){let t=[];return Object.entries(o).forEach(([r,n])=>{"code"in n&&n.code&&!T(r,e.excludes)&&t.push([r,n])}),t}function N(e,o,t){let r=new g(e.log);r.info(`obfuscating ${o}...`);let n=R.default.obfuscate(t.code,e.options).getObfuscatedCode();return r.info(`obfuscation complete for ${o}.`),n}function H(e,o){return new Promise((t,r)=>{let n=new A.Worker(P.default.join(__dirname,"./worker/index.js"));n.postMessage({config:e,chunk:o}),n.on("message",i=>{o.forEach(([s,a])=>{let u=i.find(l=>l.fileName===s);u&&u.obfuscatedCode&&(a.code=u.obfuscatedCode)}),t(i),n.unref()}),n.on("error",i=>{r(i),n.unref()})})}var W={excludes:[],enable:!0,log:!0,apply:"build",autoExcludeNodeModules:!1,threadPool:!1,options:{compact:!0,controlFlowFlattening:!0,controlFlowFlatteningThreshold:1,deadCodeInjection:!1,debugProtection:!1,debugProtectionInterval:0,disableConsoleOutput:!1,identifierNamesGenerator:"hexadecimal",log:!1,numbersToExpressions:!1,renameGlobals:!1,selfDefending:!0,simplify:!0,splitStrings:!1,stringArray:!1,stringArrayCallsTransform:!1,stringArrayCallsTransformThreshold:.5,stringArrayEncoding:[],stringArrayIndexShift:!0,stringArrayRotate:!0,stringArrayShuffle:!0,stringArrayWrappersCount:1,stringArrayWrappersChainedCalls:!0,stringArrayWrappersParametersMaxCount:2,stringArrayWrappersType:"variable",stringArrayThreshold:.75,unicodeEscapeSequence:!1}},m="vendor-modules",C=Object.freeze({info:"\x1B[36m",warn:"\x1B[33m"});function Y(){return b!=null&&b.version?Number(b.version.split(".")[0]):2}function V(e){let o=y(y({},W),e),t=new g(o.log),r=i=>{if(!o.enable||!o.autoExcludeNodeModules)return;i.build=i.build||{},i.build.rollupOptions=i.build.rollupOptions||{};let{output:s}=i.build.rollupOptions,a=u=>{if(o.excludes.push(m),u.includes("node_modules"))return m};if(!s){i.build.rollupOptions.output={manualChunks:a};return}if(S(s)){t.forceLog(C.warn,"rollupOptions.output is an array, ignoring autoExcludeNodeModules configuration.");return}if(f(s)){if(!s.manualChunks)s.manualChunks=a;else if(f(s.manualChunks))t.forceLog(C.warn,"rollupOptions.output.manualChunks is an object, ignoring autoExcludeNodeModules configuration.");else if(v(s.manualChunks)){let u=s.manualChunks;o.excludes.push(m),s.manualChunks=(l,c)=>l.includes("node_modules")?m:u(l,c)}}},n=async(i,{bundle:s})=>{if(!o.enable||!s)return i;t.forceLog("starting obfuscation process...");let a=performance.now(),u=z(o,s);if(_(o)){let c=Math.min(F(o),u.length),p=Math.ceil(u.length/c),j=[];for(let h=0;h<c;h++){let $=u.slice(h*p,(h+1)*p);j.push(H(o,$))}await Promise.all(j)}else u.forEach(([c,p])=>{p.code=N(o,c,p)});let l=B(performance.now()-a);return t.forceLog(C.info+"%s\x1B[0m %s","\u2713",`obfuscation process completed in ${l}.`),i};return{name:"vite-plugin-bundle-obfuscator",apply:o.apply,config:r,transformIndexHtml:Y()>=5?{order:"post",handler:n}:{enforce:"post",transform:n}}}
